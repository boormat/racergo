<html>
	<head>
		{{if not .Next}}
			<meta http-equiv="refresh" content="30">
		{{end}}
		{{if .Start}}
			<script type="text/javascript">
				var seconds = {{.Seconds}};
				function FormatNumberLength(num, length) {
					var r = "" + num;
					while (r.length < length) {
						r = "0" + r;
					}
					return r;
				}
				function updateTime() {
					document.getElementById("time").innerHTML = FormatNumberLength(Math.floor(seconds/60/60),2) + ":" + FormatNumberLength(Math.floor((seconds/60)%60),2) + ":" + FormatNumberLength((seconds%60),2);
					seconds++;
				}
				function start() {
					setTimeout(function() {
						updateTime();
						setInterval(updateTime,1000);
					},{{.NextUpdate}});
				}
				window.onload = start;
			</script>
		{{end}}
	</head>
	<body>
		{{if .Admin}}
			{{if .Next}}
				<form action="linkBib" method="post">
					<label for="bib">Bib #</label>
					<input type="number" name="bib" id="bib" required="required" autofocus>
					<label for="next">Overall Place #</label>
					<input type="number" name="next" id="next" required="required" value="{{.Next}}">
					<button type="submit">Submit</button>
				</form>
			{{else}}
				<h1>All bib #'s entered for results, waiting for next finisher</h1>
			{{end}}
			<form action="uploadRacers" method="post" enctype="multipart/form-data">
				<label for="entriesUpload">Upload Registrants CSV</label>
				<input title="CSV file should have a header row containing at least Fname, Lname, Gender (M/F), and Age" type="file" id="entriesUpload" name="entries" required="required">
				<button type="submit">Upload Entries</button>
			</form>
			<form action="uploadPrizes" method="post" enctype="multipart/form-data">
				<label for="prizesUpload">Upload Prize Config</label>
				<input type="file" id="prizesUpload" name="prizes" required="required">
				<button type="submit">Upload Prizes</button>
			</form>
			<a href="/download">Download</a>
		{{end}}
		{{if .Unbibbed}}
			<table>
				<tr>
					<th>Assign Bib</th>
					<th>First</th>
					<th>Last</th>
					<th>Age</th>
					<th>Gender</th>
					<th>T-Shirt</th>
				</tr>
				{{range $id , $unbibbed := .Unbibbed}}
					<tr>
						<td>
							<form action="assignBib" method="post">
								<input type="number" name="bib" required="required">
								<input type="hidden" name="id" value="{{$id}}">
								<button type="submit">Set</button>
							</form>
						</td>
						<td>{{$unbibbed.Fname}}</td>
						<td>{{$unbibbed.Lname}}</td>
						<td>{{$unbibbed.Age}}</td>
						<td>{{if $unbibbed.Male}}M{{else}}F{{end}}</td>
						<td>{{$unbibbed.TShirt}}</td>
					</tr>
				{{end}}
			</table>
		{{end}}
		{{if .Start}}
			<h1 id="time">{{.Time}}</h1>
			<h2>Race started at {{.Start}}</h2>
		{{else}}
			<h1>Not Started</h1>
		{{end}}
		{{if not .Next}}
			<h3>Race status will auto-refresh every 30 seconds</h3>
		{{else}}
			<h3>Race status auto-refresh disabled so as to not disrupt bib input</h3>
		{{end}}
		{{range .Prizes}}
			<h3>{{.Title}}</h3>
			{{range .Winners}}
				<span>{{.Entry.Fname}} {{.Entry.Lname}} - {{.Time.String}}</span>
			{{end}}
		{{end}}
		<table>
			<tr>
				<th>Overall Place</th>
				<th>Time</th>
				<th>Bib #</th>
				<th>First</th>
				<th>Last</th>
			</tr>
			{{range .Racers}}
				<tr>
					<td>{{.Place}}</td>
					<td>{{.Time}}</td>
					<td>{{with .Entry}}{{.Bib}}{{end}}</td>
					<td>{{with .Entry}}{{.Fname}}{{end}}</td>
					<td>{{with .Entry}}{{.Lname}}{{end}}</td>
				</tr>
			{{end}}
		</table>
	</body>
</html>